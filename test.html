<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>

        <link rel="stylesheet" href="http://dashboard.rjmetrics.com/v2/css/common.beta.css?bust=d7c3b3c964957a2a9e8940d1e85426c9" type="text/css" />


        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.min.js"></script>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

        <script type="text/javascript">
          $(function(){

            function getTrendlineProse(spinnakrEvent){
              var prose = ''
                + '<div><span class="interval">' + spinnakrEvent.interval + '</span> sales of <span class="key">'+ spinnakrEvent.key +'</span> are trending ' + parseFloat(spinnakrEvent.value.slope).toPrecision(3) + '</div>'
                + '<div style="text-align: right; font-size: 10px; color: #aaa">'+ moment(spinnakrEvent.created_at).fromNow() +'</div>';

              return prose;
            }

            function getComparatorProse(spinnakrEvent){
              return "comparator";
            }


            $.get( "http://generic01.spn.ee:4567/api/1.0/events?access_token=28037e39-456d-49e4-998a-17c48ce916aa", function( data ) {
              $( ".result" ).html( data );
              //console.log(data);

              data = JSON.parse(data);
              //console.log(data);

              $.each(data, function (i, spinnakrEvent) {
                console.log(spinnakrEvent);
                $('.spinnakr-payload').append('<div class="spinnakr-event-' + i + '"></div>');
                var markup = $('.spinnakr-event-' + i);

                var prose;

                if (spinnakrEvent.event_type == "trendline") {
                  prose = getTrendlineProse(spinnakrEvent);
                }else if(spinnakrEvent.event_type == "comparator"){
                  prose = getComparatorProse(spinnakrEvent);
                }

                $(markup).html('<div class="alert alert-neutral">' + prose + '</div>');

              });

            });
          });
        </script>


    </head>
    <body style="background: url('./bg.png');">

      <br><br>

      <div class="pull-right" style="background: rgba(255,255,255,0.8); padding: 15px; border: #ddd 1px solid; border-right: 0px;">

        <div class="row" style="">
          <div class="span pull-right" style="font-size: 12px; font-weight: 200; margin-top: 0px; margin-bottom: 15px;">Insights from Spinnakr</div>
        </div>

        <div class="row">

          <div class="spinnakr-payload span5" style=""></div>

        </div>

      </div>

    </body>
</html>
